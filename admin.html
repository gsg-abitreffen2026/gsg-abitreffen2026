<!DOCTYPE html><html lang="de"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><title>Adminbereich ‚Äì Abi 2006</title><style>/* ... (wie vorher) ... */</style></head><body>
<div id="loginBox" class="login-box"><h2>Admin-Login</h2><input type="password" id="adminPassword" placeholder="Passwort" /><button onclick="checkLogin()">Einloggen</button></div>
<div id="adminContent" class="hidden">
  <h1>Adminbereich</h1>

  <h2>Offene Anmeldungen</h2>
  <button onclick="freigabeMehr()">Mehrere freigeben</button>
  <table><thead><tr><th><input type="checkbox" id="selectAll" onchange="toggleAll(this)"/></th><th>Vorname</th><th>Nachname</th><th>E-Mail</th><th>L√∂schen</th></tr></thead><tbody id="regsBody"></tbody></table>

  <h2>Freigaben / Galerie-Zug√§nge</h2>
  <table><thead><tr><th>Vorname</th><th>Nachname</th><th>E-Mail</th><th>Zugangscode</th><th>L√∂schen</th></tr></thead><tbody id="galBody"></tbody></table>

  <h2>Newsletter schreiben</h2><input id="newsletterSubject" placeholder="Betreff.." /><textarea id="newsletterBody" rows="8"></textarea><input id="testEmail" placeholder="Test-E-Mail" /><button onclick="sendNewsletter()">Senden</button>
  <p id="statusMsg"></p>
</div>

<script>
const SCRIPT = "https://script.google.com/macros/s/AKfycbxtc0G6CDfMloMew6j1LySqSsEOqUvIzHnF4dsad7mn0NXOKwPO0q3QEBQMymKqKCwg/exec";
const ADMIN_PASSWORD = "admin2026";

function checkLogin(){
  if(document.getElementById("adminPassword").value === ADMIN_PASSWORD){
    document.getElementById("loginBox").style.display="none";
    document.getElementById("adminContent").classList.remove("hidden");
    loadData();
  } else alert("Falsches Passwort");
}

async function loadData(){
  const res = await fetch(SCRIPT);
  const json = await res.json();
  renderRegs(json.registrations);
  renderGallery(json.gallery);
}

function renderRegs(list){
  const tbody = document.getElementById("regsBody");
  tbody.innerHTML = "";
  list.forEach(u => {
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td><input type="checkbox" class="chk" value="${u.email}"></td>
      <td>${u.vorname}</td><td>${u.nachname}</td><td>${u.email}</td>
      <td><button onclick="loeschen('${u.email}')">üóëÔ∏è L√∂schen</button></td>`;
    tbody.appendChild(tr);
  });
}

function renderGallery(list){
  const tbody = document.getElementById("galBody");
  tbody.innerHTML = "";
  list.forEach(u => {
    const tr = document.createElement("tr");
    tr.innerHTML = `<td>${u.vorname}</td><td>${u.nachname}</td><td>${u.email}</td><td>${u.code}</td><td><button onclick="loeschen('${u.email}')">üóëÔ∏è L√∂schen</button></td>`;
    tbody.appendChild(tr);
  });
}

function toggleAll(chk){
  document.querySelectorAll(".chk").forEach(c => c.checked = chk.checked);
}

async function freigabeMehr(){
  const emails = Array.from(document.querySelectorAll(".chk:checked")).map(c => c.value);
  if(!emails.length){ alert("Keine ausgew√§hlt"); return; }
  const list = Array.from(document.querySelectorAll(".chk:checked")).map(c => {
    const tr = c.closest("tr");
    return { email: c.value, vorname: tr.children[1].textContent, nachname: tr.children[2].textContent };
  });
  for(const u of list){
    await fetch(SCRIPT, { method:"POST", body:new URLSearchParams({ action:"freigeben", email:u.email, vorname:u.vorname, nachname:u.nachname }) });
  }
  loadData();
}

async function loeschen(email){
  if(!confirm(`Wirklich l√∂schen: ${email}?`)) return;
  await fetch(SCRIPT, { method:"POST", body:new URLSearchParams({ action:"delete", email }) });
  loadData();
}

async function sendNewsletter(){
  const subject=document.getElementById("newsletterSubject").value;
  const body=document.getElementById("newsletterBody").value;
  const test=document.getElementById("testEmail").value;
  if(!subject||!body){ alert("Betreff & Inhalt erforderlich"); return; }
  const res=await fetch(SCRIPT,{ method:"POST", body:new URLSearchParams({ action:"sendNewsletter", subject, body, test }) });
  document.getElementById("statusMsg").textContent = (await res.json()).message;
}
</script>
</body></html>
